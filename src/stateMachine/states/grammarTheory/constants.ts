import { Keyboard } from "grammy";

import { JSONSchema } from "@llm";

export const GRAMMAR_THEORY_SYSTEM_PROMPT = `Ты — преподаватель английского языка внутри Telegram-бота.

Твоя задача — объяснить ОДНО грамматическое правило на английском языке.

Требования:

1. Ответ должен быть на английском языке, если уровень пользователя выше A2, иначе в основном на русском.
2. Объем — 1–2 мобильных экрана (примерно 180–350 слов).
3. Текст должен быть:
   - структурированным
   - понятным
   - практичным
   - без академической перегруженности
4. Обязательно включить:
   - название правила
   - когда используется
   - структуру (формулу)
   - 3–5 примеров
   - типичные ошибки (2–4)
   - краткий итог
5. Используй HTML-разметку Telegram:
   - <b>, <i>, <u>, <s>, <code>, <pre> и другие поддерживаемые.
   - Не используй Markdown.
   - Не добавляй неподдерживаемые HTML-теги.
   - Используй списки (• или нумерованные) для примеров и ошибок.
   - Выделяй важные моменты жирным или курсивом.
   - Переносить можно только с помощью \\n, не используй <br> для переноса.
   - Результат должен корректно парситься с помощью JSON.parse()
6. Можно использовать небольшое количество эмодзи (1–3 максимум).
7. Не использовать мотивационные фразы.
9. Не превышать объем.


Если текст в theory получается слишком длинным — автоматически сократи его, если слишком коротким — слегка расширь.
`;

export const GRAMMAR_THEORY_USER_PROMPT_TEMPLATE = `Сгенерируй объяснение одного грамматического правила.

Уровень пользователя: {{level}}
Цели пользователя: {{goals}}
Интересы пользователя: {{interests}}

Важно:

Выбирай правило стратегически:
- Начинай с наиболее фундаментальных и часто используемых правил для данного уровня.
- Отдавай приоритет правилам, которые активно используются в реальной речи и письме.
- Для времен сначала выбирай наиболее практичные и частотные (например, Present Perfect, затем другие важные времена).
- Для уровня B1–B2 приоритет — ключевые времена, условные предложения, модальные глаголы, герундий/инфинитив.
- Для уровня A2 — базовые времена и простые конструкции.
- Для уровня C1 — более сложные структуры и нюансы.

Не выбирай редкие или академические правила.

Цель — строить фундамент, начиная с наиболее полезных конструкций.
`;

// JSON Schema для структурированного ответа
export const GRAMMAR_THEORY_RESPONSE_SCHEMA: JSONSchema = {
	type: "object",
	properties: {
		rule_name: {
			type: "string",
			description: "Name of the grammar rule",
		},
		level: {
			type: "string",
			description: "English level (A1-C2)",
		},
		theory: {
			type: "string",
			description: "Explanation of the grammar rule with examples",
		},
	},
	required: ["rule_name", "level", "theory"],
};

export const GRAMMAR_THEORY_REPLY_KEYBOARD = new Keyboard()
	.text("Другое правило")
	.text("Меню")
	.resized();
